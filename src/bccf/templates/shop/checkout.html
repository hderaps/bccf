{% extends "shop/base.html" %}
{% load shop_tags mezzanine_tags i18n future %}

{% block meta_title %}{% trans "Checkout" %} - {{ step_title }}{% endblock %}
{% block title %}{% trans "Checkout" %} - {% trans "Step" %} {{ step }} {% trans "of" %} {{ steps|length }}{% endblock %}
{% block body_id %}checkout{% endblock %}

{% block extra_head %}
<script>
var _gaq = [['_trackPageview', '{{ request.path }}{{ step_url }}/']];
$(function() {$('.middle :input:visible:enabled:first').focus();});
</script>
{% endblock %}

{% block breadcrumb_menu %}
{% for step in steps %}
<li>
	{% if step.title == step_title %}
	<strong>{{ step.title }}</strong>
	{% else %}
	{{ step.title }}
	{% endif %}
	<span class="divider">/</span>
</li>
{% endfor %}
<li>{% trans "Complete" %}</li>
{% endblock %}

{% block content %}
    <h1>Checkout - {{ step_title }}</h1>
{% endblock %}

{% block carousels %}

{% block before-form %}{% endblock %}

{% if request.cart.has_items %}
<div class="section row">
<ul id="products-list" class="section row no-style-list center-text">
    {% for item in request.cart %}
    <li>
        <div class="col two">
    	{% if item.image %}
    	   <img alt="{{ item.description }}" src="{{ MEDIA_URL }}{% thumbnail item.image 30 30 %}" />
    	{% else %}
    	   <img alt="{{ item.description }}" />
    	{% endif %}
    	</div>
    	<div class="col six">
    	   {{ item.quantity }} x {{ item.description }}
    	</div>
    	<div class="col four">
    	   <span class="price">{{ item.total_price|currency }}</span>
    	</div>
    </li>
    {% endfor %}
</ul>
<div class="total section totals">
    <div class="col seven">&nbsp;</div>
    <div class="col five"><ul class="no-style-list">{% order_totals %}</ul></div>
</div>
<div id="edit-cart" class="section row row-two">
    <a class="lgreen-btn" href="{% url "shop_cart" %}">{% trans "Edit Cart" %}</a>
</div>
</div>
{% endif %}

<form method="post" id="checkout-form" class="form-horizontal form-shop span8">
	{% csrf_token %}

	{% with form.non_field_errors as errors %}
	{% if errors or form.errors %}
	<div class="control-group error non-field-errors">
		{% for error in errors %}
		<span class="help-inline">{{ error }}</span>
		{% empty %}
		<span class="help-inline">{% trans "Please correct the errors below." %}</span>
		{% endfor %}
	</div>
	{% endif %}
	{% endwith %}

    <div class="section">
	{% block fields %}{% endblock %}
    </div>    
    
	{% block nav-buttons %}
		{% if request.cart.has_items %}
			<div class="form-actions">
				<div class="form-actions-wrap section">
				    {% if not CHECKOUT_STEP_FIRST %}
					<input type="submit" class="lgreen-btn" name="back" value="{% trans "Back" %}">
					{% endif %}
					<input type="submit" class="lgreen-btn" value="{% if CHECKOUT_STEP_LAST %}{% trans "Complete" %}{% else %}{% trans "Next" %}{% endif %}">
				</div>
			</div>
		{% else %}
			<p>{% trans "Your cart is empty." %}</p>
			<p>{% trans "This may be due to your session timing out after a period of inactivity." %}</p>
			<p>{% trans "We apologize for the inconvenience." %}</p>
			<br>
			<p><a class="btn btn-large btn-primary" href="{% url "page" "shop" %}">{% trans "Continue Shopping" %}</a></p>
		{% endif %}
	{% endblock %}

</form>

{% block after-form %}{% endblock after-form %}

{% endblock %}
