{% load i18n mezzanine_tags comment_tags rating_tags %}
<!-- .comment-container -->
   
    {% for comment in comments_for_thread %}
    
    <div id="comment-{{ comment.id }}"
        class="comment media section{% if comment.by_author %} comment-author{% endif %}">
    
        {% editable comment.is_public comment.is_removed %}
        
        {% if not comment.is_removed and comment.is_public or request.user.is_staff %}
        
        {% if comment.url %}
        
        <a href="{{ comment.url }}">
            <img class="pull-left media-object" src="{% gravatar_url comment.email %}">
        </a>
        <div class="media-body">
            <h4 class="media-heading"><a href="{{ comment.url }}">{{ comment.user_name }}</a>
            
        {% else %}
        
        <img class="pull-left media-object" src="{% gravatar_url comment.email %}"/>
        <div class="media-body">
            <h4 class="media-heading">{{ comment.user_name }}
            
        {% endif %}
        
                <small class="timespan">
                    {% blocktrans with sometime=comment.submit_date|timesince %}{{ sometime }} ago{% endblocktrans %}
                </small>
            </h4>
        <p>{{ comment.comment|comment_filter }}</p>
        {% endif %}
        
        {% if not comment.is_removed and comment.is_public %}
        
        <a href="#reply-{{ comment.id }}" class="reply">
            <i class="fa fa-reply"></i> {% trans "Reply" %}
        </a>
        <form class="comment-reply-form comment-form" method="post" id="reply-{{ comment.id }}"
            action="{{ comment_url }}#reply-{{ comment.id }}"
            {% if replied_to != comment.id %}style="display:none;"{% endif %}>
            <h3>{% trans "Post Reply" %}</h3>
            {{ form.errors }}
            {% if replied_to == comment.id  %}
                {% for hidden in posted_comment_form.hidden_fields %}
                    {{ hidden }}
                {% endfor %}
                {{ posted_comment_form.comment }}
            {% else %}
                {% for hidden in unposted_comment_form.hidden_fields %}
                    {{ hidden }}
                {% endfor %}
                {{ unposted_comment_form.comment }}
            {% endif %}
            {% csrf_token %}
            <div class="dashed-button form-actions">
                <input class="btn btn-primary btn-lg" type="submit" value="{% trans "Submit Reply" %}">
            </div>
        </form>

        {% else %}
            <p>
                {% if comment.is_removed %}
                <span class="glyphicon glyphicon-remove-circle"></span> {% trans "Comment deleted" %}
                {% else %}
                <span class="glyphicon glyphicon-warning-sign"></span> {% trans "Comment awaiting approval" %}
                {% endif %}
                <small class="timespan">{% blocktrans with sometime=comment.submit_date|timesince %}{{ sometime }} ago{% endblocktrans %}</small>
            </p>
        {% endif %}
    
        {% comment_thread comment %}
        
        {% endeditable %}
        </div>
    </div>
    {% endfor %}
<!-- /.comment-container -->