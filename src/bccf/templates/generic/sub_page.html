{% load bccf_feature_tags static bccf_rating_tags bccf_event_tags comment_tags embed_video_tags %}
<section id={{ child_obj.slug }} class="section subpage {{ child_obj.gparent.carousel_color }}">
    <a id="close-btn" href="#" title="Close" class="fa fa-times-circle"></a>
    <div class="subpage-tabs section">
        <ul class="no-style-list">
            <li class="col two mobile-full">
                <a href="{{ child_obj.get_absolute_url }}" id="child-home" class="baby-content-btn">Home</a>
                <div class="baby-content">
                    <div class="section row row-one social-box">
                        {% bccf_rating_for child_obj %}
                        {% include "includes/add_this.html" %}
                    </div>
                    <div class="section row-one">
                        <h3>{{ child_obj.title }}</h3>
                        {% if child_obj.content_model == 'video' %}
                        {% video child_obj.get_content_model.video_url "small" %}
                        {% endif %}
                        {% if child_obj.content_model == 'podcast' %}
                        <audio src="{{ MEDIA_URL }}{{ child_obj.get_content_model.attached_audio }}" preload="auto" controls></audio>
                        {% endif %}
                        {{ child_obj.content|safe }}
                        {% bccf_subscribe_for child_obj %}
                    </div>
                    <div class="section row row-one">
                        {% comments_for child_obj %}
                    </div>
                </div>
            </li>
            {% for baby in babies %}
            <li class="col two mobile-full">
                <a href="{{ baby.get_content_model.get_absolute_url }}" id="{{ baby.title|slugify }}" class="baby-content-btn">{{ baby.title }}</a>
                <div class="baby-content">
                    <h3>{{ baby.title }}</h3>
                    {{ baby.content|safe }}
                </div>
            </li>
            {% endfor %}
            {% if child_obj.gparent.slug == 'trainings' %}
            <li class="col two mobile-full">
                <a href="{% url 'bccf-baby' child_obj.gparent.slug child_obj.slug 'child-info' %}" id="child-info" class="baby-content-btn">Information</a>
                <div class="baby-content">
                    <h3>Event Information</h3>
                    <table>
                        <tr>
                            <th>Price:</th>
                            <td>{{ child_obj.get_content_model.price }}</td>
                        </tr>
                        <tr>
                            <th>When:</th>
                            <td>{{ child_obj.get_content_model.date_start }} {% if child_obj.get_content_model.date_end %} to {{ child_obj.get_content_model.date_end }} {% endif %}</td>
                        </tr>
                        <tr>
                            <th>Address:</th>
                            <td>{{ child_obj.get_content_model.location_street }}</td>
                        </tr>
                        {% if child_obj.get_content_model.location_street2 %}
                        <tr>
                            <th>Address 2:</th>
                            <td>{{ child_obj.get_content_model.location_street2 }}</td>
                        </tr>
                        {% endif %}
                        <tr>
                            <th>City:</th>
                            <td>{{ child_obj.get_content_model.location_city }}</td>
                        </tr>
                        <tr>
                            <th>Postal Code:</th>
                            <td>{{ child_obj.get_content_model.location_postal_code }}</td>
                        </tr>
                    </table>
                </div>
            </li>
            {% endif %}
            <!--{% if child_obj.gparent.slug == 'resources' %}
            <li class="col two mobile-full"><a href="{{ MEDIA_URL }}{{ child_obj.get_content_model.attached_document }}" target="_blank">Download</a></li>
            {% endif %}-->
            {% if child_obj.content_model == 'formpublished' %}
            <li class="col two mobile-full"><a href="{{ child_obj.get_content_model.get_survey_url }}" target="_blank">Act</a></li>
            {% endif %}
            {% if child_obj.content_model == 'topic' %}
            <li class="col two mobile-full"><a href="{{ child_obj.get_content_model.get_absolute_url }}" target="_blank">Talk</a></li>
            {% endif %}

            <li class="col two mobile-full" id="resources">
                <a href="{{ child_obj.get_absolute_url }}baby-resources" id="baby-resources" class="baby-content-btn">Resources</a>
                <div class="baby-content">
                    <div id="related-resource-outer" class="section">
                        <div class="related-resources">
                            {% related_resources_for child_obj 'article' 'Articles' %}
                            {% related_resources_for child_obj 'downloadableform' 'Downloadable Forms' %}
                            {% related_resources_for child_obj 'magazine' 'Magazines' %}
                            {% related_resources_for child_obj 'podcast' 'Podcasts' %}
                            {% related_resources_for child_obj 'tipsheet' 'Tip Sheets' %}
                            {% related_resources_for child_obj 'video' 'Videos' %}
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <div class="subpage-content section row"></div>
    <div class="home-content section row no-mobile">
        <div class="section row row-one social-box">
            {% include "includes/add_this.html" %}
            {% bccf_rating_for child_obj %}
        </div>
        <div class="section row-one">
            <h3>{{ child_obj.title }}</h3>
            {% if child_obj.content_model == 'video' %}
            {% video child_obj.get_content_model.video_url "small" %}
            {% endif %}
            {% if child_obj.content_model == 'podcast' %}
            <audio src="{{ MEDIA_URL }}{{ child_obj.get_content_model.attached_audio }}" preload="auto" controls></audio>
            {% endif %}
            {{ child_obj.content|safe }}
            {% bccf_subscribe_for child_obj %}
        </div>
        <div class="section row row-one">
            {% comments_for child_obj %}
        </div>
    </div>
</section>
<script type="text/javascript" >
var sync_height = function() {
    var height = 0;
    var highest = 0;
    $('.subpage-content .related-resource').each(function() {
        var h = $(this).height();
        if(h > height) {
            height = h;
            highest = $(this).height();
        }
    });
    $('.subpage-content .related-resource').each(function() {
        $(this).css('height', highest);
    });
};

$('#close-btn').on('click', function(e) {
    e.preventDefault(); reset();
});

$('.baby-content-btn').on('click', function(e) {
    e.preventDefault();
    var url = $(this).attr('href'); 
    
    $('.subpage-tabs a.active').removeClass('active');     

    if($(this).attr('id') !== 'child-home') {
        window.history.pushState({ path: url }, '', url);
        $(this).addClass('active'); 
    }
    pathname = url;

    if(!$('.mnav-mobile-btn').is(':visible')) {
        $('.subpage-content').hide();
        $('.home-content').hide();

        if($(this).attr('id') === 'child-home') {
            $('.home-content').show();
            return;
        }
        if($(this).attr('id') === 'baby-resources') {
            sync_height();        
        }
        $('.subpage-content').show();
    }
    if($('.mnav-mobile-btn').is(':visible')) {
        $('.subpage .baby-content').hide();
        $(this).siblings('.baby-content').slideToggle('500');
    } else {
        $('.subpage .subpage-content').html($(this).siblings('.baby-content').html());
        if($(this).attr('id') === 'baby-resources') {
            sync_height();
        }
    }
});

$(function() {
    document.title = "{{ child_obj.title|title }} | {{ child_obj.gparent.title|title }} | {{ settings.SITE_TITLE }}"
    {% if baby_obj %}
        $('#{{ baby_obj }}').trigger('click');
    {% else %}
        $('#child-home').trigger('click');
    {% endif %}
});
</script>